<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="robots" content="index,follow">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
  <title>Whispers of Test Failures - Parente's Mindtrove</title>

    <link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="../feed/index.xml" />
    <link rel="alternate" type="application/atom+xml" title="Atom 1.0" href="../feed/atom/index.xml" />
    <link rel="stylesheet" type="text/css" href="../static/css/pygments.css" />
    <link rel="stylesheet" href='//fonts.googleapis.com/css?family=Dosis:300,600' type='text/css'>
    <link rel="stylesheet" href='//fonts.googleapis.com/css?family=Gentium+Basic' type='text/css'>
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
    <link rel="stylesheet" href="../static/css/site.css" type="text/css" media="screen" />

    <!-- Google Analytics -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-50187496-1', 'mindtrove.info');
      ga('send', 'pageview');

    </script>
  </head>
  <body>
    <div class="container">
      <!-- Header -->
      <header id="siteTitle">
        <h1><a href="../">Parente's Mindtrove</a></h1>
        <nav>
          <a href="../">Latest</a>
          <a href="../posts/">Posts</a>
          <a href="../about/">About</a>
        </nav>
      </header>

      <!-- Main Body -->
      <article id="mainColumn">
        
  <h1 class="pageTitle">Whispers of Test Failures</h1>
    <p class="pageDate">April 19, 2014</p>
  <p>Yesterday, I learned that support for the <a href="https://dvcs.w3.org/hg/speech-api/raw-file/tip/speechapi.html#tts-section">speech synthesis portion of the Web Speech API spec</a> landed in Chrome stable. I also learned that I'm behind the curve given that the <a href="http://updates.html5rocks.com/2014/01/Web-apps-that-talk---Introduction-to-the-Speech-Synthesis-API">HTML5 Rocks Speech Synthesis tutorial</a> was published nearly four months ago. I immediately set out to rectify this situation by having my browser whisper my frontend test failures to me.</p>
<div class="centered">
  <a href="http://s1000.photobucket.com/user/LanningCk/media/Gifs/explain.gif.html" target="_blank"><img src="http://i1000.photobucket.com/albums/af128/LanningCk/Gifs/explain.gif" class="rounded" alt="Image of Dalek exclaiming EXPLAIN!"/></a>
</div>

<p>I've been playing the part of frontend web dev recently at work. While I'm developing, I keep my <a href="http://visionmedia.github.io/mocha/">Mocha</a> test runner page open in Chrome with <a href="http://livereload.com/">LiveReload</a> automatically refreshing the page every time I save a file. As I write new tests and code, I keep an eye on the Mocha results to ensure I'm not seriously regressing previous work. It's a decent, single-browser sanity check, but it does take up valuable screen space and requires flickers of my visual attention.</p>
<div class="centered">
  <a href="http://imgur.com/J41wqlY"><img class="rounded" src="http://i.imgur.com/J41wqlY.jpg" alt="Image of Cyberman saying YOU WILL BE UPGRADED" title="Hosted by imgur.com" /></a>
</div>

<p>Enter Chrome text-to-speech. I added a bit of JavaScript to our Mocha test runner that speaks aloud the test case failure count. With this addition, I keep the test page tab in the background and simply listen for failure announcements to get an idea of how badly I've broken my sandbox.</p>
<p>Here's the relevant code in the context of a RequireJS callback.</p>
<div class="codehilite"><pre><span></span><span class="nx">requirejs</span><span class="p">([</span>
    <span class="s1">&#39;jquery&#39;</span><span class="p">,</span>
    <span class="s1">&#39;mocha&#39;</span><span class="p">,</span>
    <span class="s1">&#39;should&#39;</span><span class="p">,</span>
    <span class="s1">&#39;test_foo&#39;</span><span class="p">,</span>
    <span class="s1">&#39;test_bar&#39;</span>
<span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">$</span><span class="p">,</span> <span class="nx">mocha</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// Ignore livereload if used</span>
  <span class="nx">mocha</span><span class="p">.</span><span class="nx">checkLeaks</span><span class="p">([</span><span class="s1">&#39;LiveReload&#39;</span><span class="p">]);</span>

  <span class="k">if</span><span class="p">(</span><span class="nb">window</span><span class="p">.</span><span class="nx">speechSynthesis</span><span class="p">)</span> <span class="p">{</span>

    <span class="c1">// I want my Mac whispering, so I have to wait for the voiceschanged</span>
    <span class="c1">// event to fire. If I weren&#39;t so picky, I wouldn&#39;t need this listener.</span>
    <span class="nx">$</span><span class="p">(</span><span class="nx">speechSynthesis</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;voiceschanged&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

      <span class="c1">// Run my tests</span>
      <span class="kd">var</span> <span class="nx">run</span> <span class="o">=</span> <span class="nx">mocha</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

        <span class="c1">// Got failures? Fire up the text-to-speech!</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">run</span><span class="p">.</span><span class="nx">failures</span><span class="p">)</span> <span class="p">{</span>
          <span class="c1">// I&#39;ve got a Mac. I know this voice exists. I&#39;m primarily doing this</span>
          <span class="c1">// for myself so ... hardcode!</span>
          <span class="kd">var</span> <span class="nx">v</span> <span class="o">=</span> <span class="nx">speechSynthesis</span><span class="p">.</span><span class="nx">getVoices</span><span class="p">().</span><span class="nx">filter</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">voice</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">return</span> <span class="nx">voice</span><span class="p">.</span><span class="nx">name</span> <span class="o">==</span> <span class="s1">&#39;Whisper&#39;</span><span class="p">;</span>
          <span class="p">});</span>
          <span class="c1">// Build an utterance</span>
          <span class="kd">var</span> <span class="nx">msg</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SpeechSynthesisUtterance</span><span class="p">(</span><span class="nx">run</span><span class="p">.</span><span class="nx">failures</span> <span class="o">+</span> <span class="s1">&#39;failed&#39;</span><span class="p">);</span>
          <span class="c1">// Set the voice properties</span>
          <span class="k">if</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">voice</span> <span class="o">=</span> <span class="nx">v</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
          <span class="nx">msg</span><span class="p">.</span><span class="nx">rate</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
          <span class="c1">// And ...</span>
          <span class="nx">speechSynthesis</span><span class="p">.</span><span class="nx">speak</span><span class="p">(</span><span class="nx">msg</span><span class="p">);</span>
        <span class="p">}</span>

      <span class="p">});</span>

    <span class="p">});</span>

  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// Don&#39;t break mute browsers</span>
    <span class="nx">mocha</span><span class="p">.</span><span class="nx">run</span><span class="p">();</span>
  <span class="p">}</span>

<span class="p">});</span>
</pre></div>


<p>The upgrade works wonderfully, with a rare browser tab crash that I'm sure the Chrome devs will iron out in due time. Beyond that, one change might make it better: an appropriately villainous robotic voice.</p>
<div class="centered">
  <a href="http://imgur.com/CvoLSHs"><img class="rounded" src="http://i.imgur.com/CvoLSHs.jpg?1" title="Hosted by imgur.com" alt="Image of Weakest Link Robot Host from Doctor Who saying GOODBYE" /></a>
</div>

<p class="footnote">All images on this page are third-party works derived from robots of the <a href="http://www.bbc.co.uk/programmes/b006q2x0">Doctor Who</a> universe, copyright <a href="http://www.bbc.com">the BBC</a>, producers of quintessential synthetic voices.</p>

      </article>

      <!-- Meta -->
      
    <div class="footerSection" id="pageMeta">
        <h3>Another Read: <a href="../a-reveal.js-docker-base-image-with-onbuild">A reveal.js Docker Base Image with ONBUILD &#187;</a></h3>
        <div class="excerpt"><p>Docker 0.8 introduced the <code>ONBUILD</code> instruction for Dockerfiles. I'll admit, when I read <a href="http://blog.docker.io/2014/02/docker-0-8-quality-new-builder-features-btrfs-storage-osx-support/">the release announcement</a>, I glossed right over this new feature. Now that I've had time to <a href="http://docs.docker.io/en/latest/reference/builder/#onbuild">read more about it</a>, I can see its potential for creating build environments.</p></div>
    </div>


      <div class="row footerSection" id="siteMeta">
        <div class="col-md-4" id="contact">
          <h3>Contact</h3>
          <div>
            <i class="fa fa-envelope-o fa-fw"></i> <a title="Email address" href="mailto:parente@cs.unc.edu"> parente@cs.unc.edu</a><br/>
            <i class="fa fa-github fa-fw"></i> <a title="GitHub account" href="https://github.com/parente">github.com/parente</a><br/>
            <i class="fa fa-twitter fa-fw"></i> <a title="Twitter account" href="https://twitter.com/parente">twitter.com/parente</a><br/>
          </div>
        </div>

        <div class="col-md-5" id="latest">
          <h3>Latest</h3>
          <ul>
            <li><a href="../jupyter-tidbit-display-handles">Jupyter Tidbit: Display handles</a></li>
            <li><a href="../jupyter-tidbit-ipython-slists">Jupyter Tidbit: IPython's ! returns an SList</a></li>
            <li><a href="../jupyter-tidbit-run-notebook-headlessly">Jupyter Tidbit: Run a notebook headlessly</a></li>
            <li><a href="../jupyter-tidbit-run-and-say-done">Jupyter Tidbit: Run and say "done!"</a></li>
          </ul>
        </div>

        <div class="col-md-3" id="other">
          <h3>More</h3>
          <ul>
            <li><a href="../posts/">See all posts &#187;</a></li>
            <li><a href="../feed/index.xml">Subscribe to posts &#187;</a></li>
          </ul>
        </div>
      </div>

      <!-- Footer -->
      <footer id="siteFooter" class="footerSection">
        <p class="footerText">Copyright &copy; 2008, 2018 Peter Parente. All rights reserved. Except for materials otherwise noted. </p>
      </footer>
    </div>
  </body>
</html>